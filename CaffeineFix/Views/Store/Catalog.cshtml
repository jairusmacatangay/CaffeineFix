
@{
    ViewBag.Title = "Catalog";
}
<link href="~/Content/store-style.css" rel="stylesheet" />
<link href="~/Content/themes/base/jquery-ui.min.css" rel="stylesheet" />
<script src="~/Scripts/jquery-ui-1.12.1.min.js"></script>

<br />

<div class="row">

    <!--Advanced Search-->
    <div class="col-3">

        <!--Autocomplete Search-->
        <div class="input-group ui-widget">
            <input type="text" class="form-control" id="autoCompleteProducts" placeholder="Search" />
            <div class="input-group-append">
                <button class="btn btn-success input-group-text" id="searchProduct"><i class="fa fa-search"></i></button>
            </div>
        </div>
        <hr />

        <div class="mb-2"><b>Categories</b></div>

        <!--Coffee Checkbox-->
        <div class="form-check" id="groupCheckCoffee">
            <input class="form-check-input" type="checkbox" value="" id="checkCoffee">
            <label class="form-check-label text-muted" for="checkCoffee">
                Coffee
            </label>
        </div>

        <!--Equipment Checkbox-->
        <div class="form-check" id="groupCheckEquipment">
            <input class="form-check-input" type="checkbox" value="" id="checkEquipment">
            <label class="form-check-label text-muted" for="checkEquipment">
                Equipment
            </label>
        </div>

        <!--Drinkware Checkbox-->
        <div class="form-check" id="groupCheckDrinkware">
            <input class="form-check-input" type="checkbox" value="" id="checkDrinkware">
            <label class="form-check-label text-muted" for="checkDrinkware">
                Drinkware
            </label>
        </div>
        <hr />

        <div class="mb-2"><b>Coffee</b></div>

        <!--Dark Roast Checkbox-->
        <div class="form-check" id="groupCheckDarkRoast">
            <input class="form-check-input" type="checkbox" value="" id="checkDarkRoast">
            <label class="form-check-label text-muted" for="checkDarkRoast">
                Dark Roast
            </label>
        </div>

        <!--Medium Roast Checkbox-->
        <div class="form-check" id="groupCheckMediumRoast">
            <input class="form-check-input" type="checkbox" value="" id="checkMediumRoast">
            <label class="form-check-label text-muted" for="checkMediumRoast">
                Medium Roast
            </label>
        </div>

        <!--Blonde Roast Checkbox-->
        <div class="form-check" id="groupCheckBlondeRoast">
            <input class="form-check-input" type="checkbox" value="" id="checkBlondeRoast">
            <label class="form-check-label text-muted" for="checkBlondeRoast">
                Blonde Roast
            </label>
        </div>
        <hr />

        <div class="mb-2"><b>Equipment</b></div>

        <!--Coffee Supplies Checkbox-->
        <div class="form-check" id="groupCheckCoffeeSupplies">
            <input class="form-check-input" type="checkbox" value="" id="checkCoffeeSupplies">
            <label class="form-check-label text-muted" for="checkCoffeeSupplies">
                Coffee Supplies
            </label>
        </div>

        <!--Coffee Maker Checkbox-->
        <div class="form-check" id="groupCheckCoffeeMaker">
            <input class="form-check-input" type="checkbox" value="" id="checkCoffeeMaker">
            <label class="form-check-label text-muted" for="checkCoffeeMaker">
                Coffee Maker
            </label>
        </div>

        <!--Grinder Checkbox-->
        <div class="form-check" id="groupCheckGrinder">
            <input class="form-check-input" type="checkbox" value="" id="checkGrinder">
            <label class="form-check-label text-muted" for="checkGrinder">
                Grinder
            </label>
        </div>
        <hr />

        <div class="mb-2"><b>Drinkware</b></div>

        <!--Mug Checkbox-->
        <div class="form-check mt-2" id="groupCheckMug">
            <input class="form-check-input" type="checkbox" value="" id="checkMug">
            <label class="form-check-label text-muted" for="checkMug">
                Mug
            </label>
        </div>

        <!--Tumblr Checkbox-->
        <div class="form-check" id="groupCheckTumblr">
            <input class="form-check-input" type="checkbox" value="" id="checkTumblr">
            <label class="form-check-label text-muted" for="checkTumblr">
                Tumblr
            </label>
        </div>
        <hr />

        <!--Price Range-->
        <div class="form-inline">
            <div class="form-group">
                <label for="amount"><b>Price Range:</b></label>
                <input type="text" class="mx-1" id="amount" readonly style="border:0; color:#f6931f; font-weight:bold;" />
            </div>
        </div>

        <!--Price Range Slider-->
        <div class="row mt-2">
            <div class="col-9">
                <div class="mt-2 ml-2" id="priceRange"></div>
            </div>
            <div class="col-3">
                <button class="btn btn-success btn-sm" id="filterRange">Go</button>
            </div>
        </div>
    </div>

    <div class="col-9">

        <div class="row mb-2">

            <div class="col-4 mt-2">
                <p>Displaying 12 out of 25 products</p>
            </div>

            <div class="col-2"></div>

            <div class="col-4">
                <div class="form-row">
                    <span class="col-2"></span>
                    <label class="col-3 mt-2">Sort by: </label>
                    @Html.DropDownList("sortOption", ViewBag.SortOptions as SelectList, "Select", new { @class = "form-control col-7" })
                </div>
            </div>

            <div class="col-2">
                <div class="form-row">
                    <span class="col-1"></span>
                    <label class="col-5 mt-2">View: </label>
                    <span class="col-3 mt-2"><i class="fa fa-th-large fa-lg" id="gridView"></i></span>
                    <span class="col-3 mt-2"><i class="fa fa-th-list fa-lg" id="listView"></i></span>
                </div>
            </div>

        </div>

        <div class="row" id="viewProducts"></div>
        <br />

        <div class="row">
            <nav aria-label="Page navigation example" class="ml-auto mr-2">
                <ul class="pagination">
                    <li class="page-item disabled">
                        <a class="page-link" href="#" tabindex="-1">Previous</a>
                    </li>
                    <li class="page-item"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item">
                        <a class="page-link" href="#">Next</a>
                    </li>
                </ul>
            </nav>
        </div>

    </div>

</div>


<script>
    $(document).ready(function () {
        viewAllProducts('grid');

        document.getElementById('listView').value = false;
        document.getElementById('gridView').value = true;

        $("#priceRange").slider({
            range: true,
            min: 300,
            max: 5000,
            values: [300, 5000],
            slide: function (event, ui) {
                $("#amount").val("₱" + ui.values[0] + " - ₱" + ui.values[1]);
            }
        });

        $("#amount").val(`₱ ${$("#priceRange").slider("values", 0)} - ₱ ${$("#priceRange").slider("values", 1)}`);
        
        $(document).on("click", "#filterRange", () => {
            let minPrice = $("#priceRange").slider("values", 0);
            let maxPrice = $("#priceRange").slider("values", 1);
            let view = getCurrentView();

            $.ajax({
                type: "POST",
                url: "/Store/FilterByPrice",
                data: { minPrice: minPrice, maxPrice: maxPrice, view: view },
                dataType: "html",
                success: (response) => {
                    $("#viewProducts").empty();
                    $("#viewProducts").html(response);
                }
            });

        });

        $("#autoCompleteProducts").autocomplete({
            source: (request, response) => {
                let query = $("#autoCompleteProducts").val();

                $.ajax({
                    type: "GET",
                    url: `/Store/AutoCompleteProducts?query=${query}`,
                    data: { query: request.term },
                    success: (data) => {
                        response($.map(data, (item) => {
                            return { label: item.ProductName, value: item.ProductName }
                        }))
                    }
                });
            }
        });

        $(document).on("click", "#searchProduct", () => {
            let searchText = $("#autoCompleteProducts").val();
            let view = getCurrentView();         

            $.ajax({
                type: "POST",
                url: "/Store/SearchProduct",
                data: { search: searchText, view: view },
                dataType: "html",
                success: (response) => {
                    $("#viewProducts").empty();
                    $("#viewProducts").html(response);
                }
            });
        });

        $("#checkCoffee").change(() => {
            let view = getCurrentView();

            if (document.getElementById("checkCoffee").checked) {
                $("#groupCheckEquipment").hide();
                $("#groupCheckDrinkware").hide();
                setFalseToCheckbox("checkCoffee");
                displayCheckboxOptions(groupNotCategory);
                ajaxFilterProductsBy("Coffee", view);
            } else {
                $("#groupCheckEquipment").show();
                $("#groupCheckDrinkware").show();
                $("#viewProducts").empty();
                viewAllProducts(view);
            }
        });

        $("#checkEquipment").change(() => {
            let view = getCurrentView();

            if (document.getElementById("checkEquipment").checked) {
                $("#groupCheckCoffee").hide();
                $("#groupCheckDrinkware").hide();
                setFalseToCheckbox("checkEquipment");
                displayCheckboxOptions(groupNotCategory);
                ajaxFilterProductsBy("Equipment", view);
            } else {
                $("#groupCheckCoffee").show();
                $("#groupCheckDrinkware").show();
                $("#viewProducts").empty();
                viewAllProducts(view);
            }
        });

        $("#checkDrinkware").change(() => {
            let view = getCurrentView();

            if (document.getElementById("checkDrinkware").checked) {
                $("#groupCheckCoffee").hide();
                $("#groupCheckEquipment").hide();
                setFalseToCheckbox("checkDrinkware");
                displayCheckboxOptions(groupNotCategory);
                ajaxFilterProductsBy("Drinkware", view);
            } else {
                $("#groupCheckCoffee").show();
                $("#groupCheckEquipment").show();
                $("#viewProducts").empty();
                viewAllProducts(view);
            }
        });

        $("#checkDarkRoast").change(() => {
            let view = getCurrentView();

            if (document.getElementById("checkDarkRoast").checked) {
                $("#groupCheckMediumRoast").hide();
                $("#groupCheckBlondeRoast").hide();
                setFalseToCheckbox("checkDarkRoast");
                displayCheckboxOptions(groupNotCoffee);
                ajaxFilterProductsBy("Dark Roast", view);
            } else {
                $("#groupCheckMediumRoast").show();
                $("#groupCheckBlondeRoast").show();
                $("#viewProducts").empty();
                viewAllProducts(view);
            }
        });

        $("#checkMediumRoast").change(() => {
            let view = getCurrentView();

            if (document.getElementById("checkMediumRoast").checked) {
                $("#groupCheckDarkRoast").hide();
                $("#groupCheckBlondeRoast").hide();
                setFalseToCheckbox("checkMediumRoast");
                displayCheckboxOptions(groupNotCoffee);
                ajaxFilterProductsBy("Medium Roast", view);
            } else {
                $("#groupCheckDarkRoast").show();
                $("#groupCheckBlondeRoast").show();
                $("#viewProducts").empty();
                viewAllProducts(view);
            }
        });

        $("#checkBlondeRoast").change(() => {
            let view = getCurrentView();

            if (document.getElementById("checkBlondeRoast").checked) {
                $("#groupCheckDarkRoast").hide();
                $("#groupCheckMediumRoast").hide();
                setFalseToCheckbox("checkBlondeRoast");
                displayCheckboxOptions(groupNotCoffee);
                ajaxFilterProductsBy("Light Roast", view);
            } else {
                $("#groupCheckDarkRoast").show();
                $("#groupCheckMediumRoast").show();
                $("#viewProducts").empty();
                viewAllProducts(view);
            }
        });

        $("#checkCoffeeSupplies").change(() => {
            let view = getCurrentView();

            if (document.getElementById("checkCoffeeSupplies").checked) {
                $("#groupCheckCoffeeMaker").hide();
                $("#groupCheckGrinder").hide();
                setFalseToCheckbox("checkCoffeeSupplies");
                displayCheckboxOptions(groupNotEquipment);
                ajaxFilterProductsBy("Coffee Supplies", view);
            } else {
                $("#groupCheckCoffeeMaker").show();
                $("#groupCheckGrinder").show();
                $("#viewProducts").empty();
                viewAllProducts(view);
            }
        });

        $("#checkCoffeeMaker").change(() => {
            let view = getCurrentView();

            if (document.getElementById("checkCoffeeMaker").checked) {
                $("#groupCheckCoffeeSupplies").hide();
                $("#groupCheckGrinder").hide();
                setFalseToCheckbox("checkCoffeeMaker");
                displayCheckboxOptions(groupNotEquipment);
                ajaxFilterProductsBy("Coffee Maker", view);
            } else {
                $("#groupCheckCoffeeSupplies").show();
                $("#groupCheckGrinder").show();
                $("#viewProducts").empty();
                viewAllProducts(view);
            }
        });

        $("#checkGrinder").change(() => {
            let view = getCurrentView();

            if (document.getElementById("checkGrinder").checked) {
                $("#groupCheckCoffeeSupplies").hide();
                $("#groupCheckCoffeeMaker").hide();
                setFalseToCheckbox("checkGrinder");
                displayCheckboxOptions(groupNotEquipment);
                ajaxFilterProductsBy("Grinder", view);
            } else {
                $("#groupCheckCoffeeSupplies").show();
                $("#groupCheckCoffeeMaker").show();
                $("#viewProducts").empty();
                viewAllProducts(view);
            }
        });

        $("#checkMug").change(() => {
            let view = getCurrentView();

            if (document.getElementById("checkMug").checked) {
                $("#groupCheckTumblr").hide();
                setFalseToCheckbox("checkMug");
                displayCheckboxOptions(groupNotDrinkware);
                ajaxFilterProductsBy("Mug", view);
            } else {
                $("#groupCheckTumblr").show();
                $("#viewProducts").empty();
                viewAllProducts(view);
            }
        });

        $("#checkTumblr").change(() => {
            let view = getCurrentView();

            if (document.getElementById("checkTumblr").checked) {
                $("#groupCheckMug").hide();
                setFalseToCheckbox("checkTumblr");
                displayCheckboxOptions(groupNotDrinkware);
                ajaxFilterProductsBy("Tumblr", view);
            } else {
                $("#groupCheckMug").show();
                $("#viewProducts").empty();
                viewAllProducts(view);
            }
        });

        $("#sortOption").change(() => {
            let selectedOption = document.getElementById('sortOption').value;
            let view = getCurrentView();

            $.ajax({
                type: "POST",
                url: "/Store/SortProductsBy",
                data: { selectedOption: selectedOption, view: view },
                dataType: "html",
                success: (response) => {
                    $("#viewProducts").empty();
                    $("#viewProducts").html(response);
                }
            });

        });

        $(document).on("click", "#listView", () => {
            let listIcon = document.getElementById('listView');
            let gridIcon = document.getElementById('gridView');

            listIcon.style.color = 'black';
            gridIcon.style.color = 'darkgray';
            listIcon.value = true;
            gridIcon.value = false;

            $.ajax({
                type: "POST",
                url: "/Store/GetAllProducts",
                data: { view: 'list' },
                dataType: "html",
                success: (response) => {
                    $("#viewProducts").empty();
                    $("#viewProducts").html(response);
                }
            });
        });

        $(document).on("click", "#gridView", () => {
            let listIcon = document.getElementById('listView');
            let gridIcon = document.getElementById('gridView');

            listIcon.style.color = 'darkgray';
            gridIcon.style.color = 'black';
            listIcon.value = false;
            gridIcon.value = true;

            $.ajax({
                type: "POST",
                url: "/Store/GetAllProducts",
                data: { view: 'grid' },
                dataType: "html",
                success: (response) => {
                    $("#viewProducts").empty();
                    $("#viewProducts").html(response);
                }
            });
        });
    });

    let viewAllProducts = (view) => {
        let url = `/Store/GetAllProducts?view=${view}`;
        $("#viewProducts").load(url)
    };

    let checkboxOptions = [
        "checkCoffee",
        "checkEquipment",
        "checkDrinkware",
        "checkDarkRoast",
        "checkMediumRoast",
        "checkBlondeRoast",
        "checkCoffeeSupplies",
        "checkCoffeeMaker",
        "checkGrinder",
        "checkMug",
        "checkTumblr"
    ];

    let groupNotCategory = [
        "#groupCheckDarkRoast",
        "#groupCheckMediumRoast",
        "#groupCheckBlondeRoast",
        "#groupCheckCoffeeSupplies",
        "#groupCheckCoffeeMaker",
        "#groupCheckGrinder",
        "#groupCheckMug",
        "#groupCheckTumblr"
    ];

    let groupNotCoffee = [
        "#groupCheckCoffee",
        "#groupCheckEquipment",
        "#groupCheckDrinkware",
        "#groupCheckCoffeeSupplies",
        "#groupCheckCoffeeMaker",
        "#groupCheckGrinder",
        "#groupCheckMug",
        "#groupCheckTumblr"
    ];

    let groupNotEquipment = [
        "#groupCheckCoffee",
        "#groupCheckEquipment",
        "#groupCheckDrinkware",
        "#groupCheckDarkRoast",
        "#groupCheckMediumRoast",
        "#groupCheckBlondeRoast",
        "#groupCheckMug",
        "#groupCheckTumblr"
    ];

    let groupNotDrinkware = [
        "#groupCheckCoffee",
        "#groupCheckEquipment",
        "#groupCheckDrinkware",
        "#groupCheckDarkRoast",
        "#groupCheckMediumRoast",
        "#groupCheckBlondeRoast",
        "#groupCheckCoffeeSupplies",
        "#groupCheckCoffeeMaker",
        "#groupCheckGrinder"
    ];

    let setFalseToCheckbox = (id) => {
        for (i = 0; i < checkboxOptions.length; i++) {
            if (document.getElementById(checkboxOptions[i]).checked) {
                if (checkboxOptions[i] === id) continue;
                $(`#${checkboxOptions[i]}`).prop("checked", false);
            }
        }
    };

    let displayCheckboxOptions = (arrayOptions) => {
        for (i = 0; i < arrayOptions.length; i++) {
            $(arrayOptions[i]).show();
        }
    };

    let ajaxFilterProductsBy = (filterOption, view) => {
        $.ajax({
            type: "POST",
            url: "/Store/FilterProductsBy",
            data: { filterOption: filterOption, view: view },
            dataType: "html",
            success: (response) => {
                $("#viewProducts").empty();
                $("#viewProducts").html(response);
            }
        });
    };

    function getCurrentView() {
        if (document.getElementById('gridView').value == true) {
            return 'grid';
        } else {
            return 'list';
        }
    }
</script>

